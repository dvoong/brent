<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Javascript tests</title>
    <link rel="stylesheet" href="qunit.css">
  </head>

  <body>
    <div id="qunit"></div>
    <div id="qunit-fixture">
      <section id="property-selection-section">
	<button class="selected">Property1</button>
	<button>Property2</button>
	<button>Property3</button>
      </section> <!-- property-selection-section -->

      <section id="property-details-section">
	<h2>Property Details</h2>
	<table>
	  <tbody>
	    <tr>
	      <th>Name</th>
	      <td></td>
	    </tr>
	    <tr>
	      <th>Postcode</th>
	      <td></td>
	    </tr>
	    <tr>
	      <th>Type</th>
	      <td></td>
	    </tr>
	</table>
      </section> <!-- property-details-section -->

      <section id="data-section">
	<h2>Data</h2>
	<section id="data-filter-section">
	  <h3>Filter</h3>
	  <form>
	    <table>
	      <tr>
		<th>First Date</th>
		<td><input name="first-date"></td>
	      </tr>
	      <tr>
		<th>Last Date</th>
		<td><input name="last-date"></td>
	      </tr>
	      <tr>
		<th>Sensor</th>
		<td><select name="sensor"></select></td>
	      </tr>
	      <tr>
		<th></th><td><input type="submit"></td>
	      </tr>
	    </table>
	  </form>
	</section> <!-- filter-section" -->
	<div id="data-table-div" style="overflow:auto; max-height: 400px;">
	  <table id="data-table">
	    <tr>
	      <th>Datetime</th>
	      <th>Temperature (C)</th>
	      <th>Humidity (%)</th>
	      <th>Light</th>
	      <th>Occupancy (H)</th>
	      <th>Battery</th>
	    </tr>
	  </table>
	</div> <!-- data-table-div -->

	<section id="graph-section">
	  <table>
	    <tr>
	      <th>Quantity: </th>
	      <td>
		<select id="quantity-selector">
		</select>
	      </td>
	    </tr>
	  </table>
	  <div id="graph-div">
	    <svg id="graph">
	    </svg>
	  </div> <!-- graph-div -->
	</section> <!-- graph-section -->
	
      </section> <!-- data-section -->
      
      <script src="http://code.jquery.com/jquery.min.js"></script>
      <script src="../home.js"></script>
    </div> <!-- qunit-fixture -->
    
    <script src="qunit.js"></script>
    <script src="../d3.js"></script>
    
    <script>
      test("click on property selector adds the selected class to it", function(){
      console.log("test1");
      
      var buttons = $("#property-selection-section button");

      console.log("buttons");
      console.log(buttons);
      
      $(buttons[0]).click();
      equal($(buttons[0]).hasClass("selected"), true);
      equal($(buttons[1]).hasClass("selected"), false);
      equal($(buttons[2]).hasClass("selected"), false);
      console.log(buttons);

      $(buttons[1]).click();
      equal($(buttons[0]).hasClass("selected"), false);
      equal($(buttons[1]).hasClass("selected"), true);
      equal($(buttons[2]).hasClass("selected"), false);
      console.log(buttons);

      $(buttons[2]).click();
      equal($(buttons[0]).hasClass("selected"), false);
      equal($(buttons[1]).hasClass("selected"), false);
      equal($(buttons[2]).hasClass("selected"), true);
      console.log(buttons);

      console.log("button selecection");
      console.log($("#property-selection-section button"));
      
      console.log("end of test1");
      });

      <!-- TEST -->
      test("click on property selector updates property details", function(){

      console.log("test2");
      
      var buttons2 = $("#property-selection-section button");
      var propertyDetailsSection = $("#property-details-section");
      var table = propertyDetailsSection.find("table");
      var rows = table.find("tr");
      var propertyName = $(rows[0]).find("td");
      var postcode = $(rows[1]).find("td");
      var type = $(rows[2]).find("td");

      console.log("buttons2");
      console.log(buttons2);
      
      console.log("propertyName: " + propertyName.text());
      console.log("postcode: " + postcode.text());
      console.log("type: " + type.text());

      equal(propertyName.text(), "Property1");
      equal(postcode.text(), "HA0 1AA");
      equal(type.text(), "Terrace");
      
      $(buttons2[1]).trigger("click");
      equal(propertyName.text(), "Property2");
      equal(postcode.text(), "HA0 1AB");
      equal(type.text(), "Semi-Detached");
      
      $(buttons2[2]).trigger("click");
      equal(propertyName.text(), "Property3");
      equal(postcode.text(), "HA0 1AN");
      equal(type.text(), "Flat");
      
      $(buttons2[0]).trigger("click");
      equal(propertyName.text(), "Property1");
      equal(postcode.text(), "HA0 1AA");
      equal(type.text(), "Terrace");

      console.log("end of test2");
      });

      <!-- TEST -->
      test("selecting a property will update the sensor options", function(){

      var filterSection = $("#data-filter-section");
      var filterForm = filterSection.find("form");

      $("#property-selection-section button")[0].click();
      var sensorOptions = filterForm.find("select[name='sensor']").find("option");
      console.log(sensorOptions);
      equal($(sensorOptions[0]).text(), "0");
      equal($(sensorOptions[1]).text(), "1");
      
      });

      <!-- TEST -->
      test("table is populated when the document loads", function(){
      var table = $("table#data-table");
      console.log("table");
      console.log(table);
      var rows = table.find("tr");
      equal(rows.length, 4);
      });

      
      <!-- TEST -->
      test("graph is loaded when the document loads", function(){
      var graph = $("#graph-section div#graph-div svg");

      xaxis = graph.find(".x-axis");
      yaxis = graph.find(".y-axis");
      dataPoints = graph.find(".line")
      equal(xaxis.length, 1);
      equal(yaxis.length, 1);
      equal(dataPoints.length, 1);
      });
      
      <!-- TEST -->
      test("graph quantity selector options are loaded with the document", function(){
      var selectedOption = $("section#graph-section select#quantity-selector option:selected");
      equal(selectedOption.text(), "Temperature");
      var options = $("section#graph-section select#quantity-selector option");
      equal(options.length, 3);
      equal($(options[1]).text(), "Humidity");
      equal($(options[2]).text(), "Light");
      });
      
      <!-- /*global $, test, equal */ -->
      <!-- test("errors should be hidden on keypress", function () { -->
      <!-- $('input').trigger('keypress'); -->
      <!-- equal($('.has-error').is(':visible'), false); -->
      <!-- }); -->
      <!-- test("errors not be hidden unless there is a keypress", function () { -->
      <!-- equal($('.has-error').is(':visible'), true); -->
      <!-- }); -->
    </script>

  </body>
</html>
